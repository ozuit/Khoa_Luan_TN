angular.module('hr_manager').factory('Auth',function($http,$window,$cookies,$state,urls){'use strict';function urlBase64Decode(str){var output=str.replace('-','+').replace('_','/');switch(output.length%4){case 0:break;case 2:output+='==';break;case 3:output+='=';break;default:throw'Illegal base64url string!';}return window.atob(output)}function getClaimsFromToken(){var token=$window.localStorage.token?$window.localStorage.token:$cookies.get('token');var user={};if(typeof token!=='undefined'){var encoded=token.split('.')[1];user=JSON.parse(urlBase64Decode(encoded))}return user.data}var tokenClaims={};return{login:function(data,success,error){$http.post(urls.BASE_API+'/auth/login',data).success(success).error(error)},logout:function(success){$http.post(urls.BASE_API+'/auth/logout',{user_id:tokenClaims.user_id}).then(function(){tokenClaims={};$window.localStorage.clear();$cookies.remove("token");$state.go('login')})},getTokenClaims:function(){tokenClaims=getClaimsFromToken();return tokenClaims},isAuthenticated:function(success,error){var token=($window.localStorage.token)?$window.localStorage.token:$cookies.get('token');if(!token){$state.go('login');return}$http.post(urls.BASE_API+'/auth/check_token',{'access_token':token}).success(success).error(error)}}}).service('anchorSmoothScroll',function(){this.scrollTo=function(eID){var startY=currentYPosition();var stopY=elmYPosition(eID);var distance=stopY>startY?stopY-startY:startY-stopY;if(distance<100){scrollTo(0,stopY);return}var speed=Math.round(distance/100);if(speed>=20)speed=20;var step=Math.round(distance/25);var leapY=stopY>startY?startY+step:startY-step;var timer=0;if(stopY>startY){for(var i=startY;i<stopY;i+=step){setTimeout("window.scrollTo(0, "+leapY+")",timer*speed);leapY+=step;if(leapY>stopY)leapY=stopY;timer++}return}for(var i=startY;i>stopY;i-=step){setTimeout("window.scrollTo(0, "+leapY+")",timer*speed);leapY-=step;if(leapY<stopY)leapY=stopY;timer++}function currentYPosition(){if(self.pageYOffset)return self.pageYOffset;if(document.documentElement&&document.documentElement.scrollTop)return document.documentElement.scrollTop;if(document.body.scrollTop)return document.body.scrollTop;return 0}function elmYPosition(eID){var elm=document.getElementById(eID);var y=elm.offsetTop;var node=elm;while(node.offsetParent&&node.offsetParent!=document.body){node=node.offsetParent;y+=node.offsetTop}return y}}});