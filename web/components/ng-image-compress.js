"use strict";app.directive("ngImageCompress",["$q",function(e){var t=window.URL||window.webkitURL,i=function(e,t){var i=t.resizeType,a=100*t.resizeQuality||70,n="image/jpeg";void 0!==i&&"png"===i&&(n="image/png");var r=t.resizeMaxHeight||300,o=t.resizeMaxWidth||250,c=e.height,u=e.width;u>c?u>o&&(c=Math.round(c*=o/u),u=o):c>r&&(u=Math.round(u*=r/c),c=r);var s=document.createElement("canvas");s.width=u,s.height=c;var g=(s.getContext("2d").drawImage(e,0,0,u,c),s.toDataURL(n,a/100)),d=new Image;return d.src=g,d.src},a=function(e,t){var i=new Image;i.onload=function(){t(i)},i.src=e},n=function(t){var i=e.defer(),a=new FileReader;return a.onload=function(e){i.resolve(e.target.result)},a.readAsDataURL(t),i.promise};return{restrict:"A",scope:{image:"=",resizeMaxHeight:"@?",resizeMaxWidth:"@?",resizeQuality:"@?",resizeType:"@?"},link:function(e,r,o){var c=function(t,n){a(t.url,function(a){var r=i(a,e);t.compressed={dataURL:r,type:r.match(/:(.+\/.+);/)[1]},n(t)})},u=function(t){e.$apply(function(){o.multiple?e.image.push(t):e.image=t})};r.bind("change",function(i){o.multiple&&(e.image=[]);for(var a=i.target.files,r=0;r<a.length;r++){var s={file:a[r],url:t.createObjectURL(a[r])};n(a[r]).then(function(e){s.dataURL=e}),e.resizeMaxHeight||e.resizeMaxWidth?c(s,function(e){u(e)}):u(s)}})}}}]);