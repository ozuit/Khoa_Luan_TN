(function(){var e=this,t=e._,n=Array.prototype,a=Object.prototype,i=Function.prototype,r=n.push,s=n.slice,o=n.concat,c=a.toString,l=a.hasOwnProperty,u=Array.isArray,h=Object.keys,f=i.bind,p=function(e){return e instanceof p?e:this instanceof p?void(this._wrapped=e):new p(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=p),exports._=p):e._=p,p.VERSION="1.7.0";var d=function(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,a){return e.call(t,n,a)};case 3:return function(n,a,i){return e.call(t,n,a,i)};case 4:return function(n,a,i,r){return e.call(t,n,a,i,r)}}return function(){return e.apply(t,arguments)}};p.iteratee=function(e,t,n){return null==e?p.identity:p.isFunction(e)?d(e,t,n):p.isObject(e)?p.matches(e):p.property(e)},p.each=p.forEach=function(e,t,n){if(null==e)return e;t=d(t,n);var a,i=e.length;if(i===+i)for(a=0;i>a;a++)t(e[a],a,e);else{var r=p.keys(e);for(a=0,i=r.length;i>a;a++)t(e[r[a]],r[a],e)}return e},p.map=p.collect=function(e,t,n){if(null==e)return[];t=p.iteratee(t,n);for(var a,i=e.length!==+e.length&&p.keys(e),r=(i||e).length,s=Array(r),o=0;r>o;o++)a=i?i[o]:o,s[o]=t(e[a],a,e);return s};var m="Reduce of empty array with no initial value";p.reduce=p.foldl=p.inject=function(e,t,n,a){null==e&&(e=[]),t=d(t,a,4);var i,r=e.length!==+e.length&&p.keys(e),s=(r||e).length,o=0;if(arguments.length<3){if(!s)throw new TypeError(m);n=e[r?r[o++]:o++]}for(;s>o;o++)i=r?r[o]:o,n=t(n,e[i],i,e);return n},p.reduceRight=p.foldr=function(e,t,n,a){null==e&&(e=[]),t=d(t,a,4);var i,r=e.length!==+e.length&&p.keys(e),s=(r||e).length;if(arguments.length<3){if(!s)throw new TypeError(m);n=e[r?r[--s]:--s]}for(;s--;)i=r?r[s]:s,n=t(n,e[i],i,e);return n},p.find=p.detect=function(e,t,n){var a;return t=p.iteratee(t,n),p.some(e,function(e,n,i){return t(e,n,i)?(a=e,!0):void 0}),a},p.filter=p.select=function(e,t,n){var a=[];return null==e?a:(t=p.iteratee(t,n),p.each(e,function(e,n,i){t(e,n,i)&&a.push(e)}),a)},p.reject=function(e,t,n){return p.filter(e,p.negate(p.iteratee(t)),n)},p.every=p.all=function(e,t,n){if(null==e)return!0;t=p.iteratee(t,n);var a,i,r=e.length!==+e.length&&p.keys(e),s=(r||e).length;for(a=0;s>a;a++)if(i=r?r[a]:a,!t(e[i],i,e))return!1;return!0},p.some=p.any=function(e,t,n){if(null==e)return!1;t=p.iteratee(t,n);var a,i,r=e.length!==+e.length&&p.keys(e),s=(r||e).length;for(a=0;s>a;a++)if(i=r?r[a]:a,t(e[i],i,e))return!0;return!1},p.contains=p.include=function(e,t){return null!=e&&(e.length!==+e.length&&(e=p.values(e)),p.indexOf(e,t)>=0)},p.invoke=function(e,t){var n=s.call(arguments,2),a=p.isFunction(t);return p.map(e,function(e){return(a?t:e[t]).apply(e,n)})},p.pluck=function(e,t){return p.map(e,p.property(t))},p.where=function(e,t){return p.filter(e,p.matches(t))},p.findWhere=function(e,t){return p.find(e,p.matches(t))},p.max=function(e,t,n){var a,i,r=-1/0,s=-1/0;if(null==t&&null!=e){e=e.length===+e.length?e:p.values(e);for(var o=0,c=e.length;c>o;o++)a=e[o],a>r&&(r=a)}else t=p.iteratee(t,n),p.each(e,function(e,n,a){i=t(e,n,a),(i>s||i===-1/0&&r===-1/0)&&(r=e,s=i)});return r},p.min=function(e,t,n){var a,i,r=1/0,s=1/0;if(null==t&&null!=e){e=e.length===+e.length?e:p.values(e);for(var o=0,c=e.length;c>o;o++)a=e[o],r>a&&(r=a)}else t=p.iteratee(t,n),p.each(e,function(e,n,a){i=t(e,n,a),(s>i||1/0===i&&1/0===r)&&(r=e,s=i)});return r},p.shuffle=function(e){for(var t,n=e&&e.length===+e.length?e:p.values(e),a=n.length,i=Array(a),r=0;a>r;r++)t=p.random(0,r),t!==r&&(i[r]=i[t]),i[t]=n[r];return i},p.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=p.values(e)),e[p.random(e.length-1)]):p.shuffle(e).slice(0,Math.max(0,t))},p.sortBy=function(e,t,n){return t=p.iteratee(t,n),p.pluck(p.map(e,function(e,n,a){return{value:e,index:n,criteria:t(e,n,a)}}).sort(function(e,t){var n=e.criteria,a=t.criteria;if(n!==a){if(n>a||void 0===n)return 1;if(a>n||void 0===a)return-1}return e.index-t.index}),"value")};var _=function(e){return function(t,n,a){var i={};return n=p.iteratee(n,a),p.each(t,function(a,r){var s=n(a,r,t);e(i,a,s)}),i}};p.groupBy=_(function(e,t,n){p.has(e,n)?e[n].push(t):e[n]=[t]}),p.indexBy=_(function(e,t,n){e[n]=t}),p.countBy=_(function(e,t,n){p.has(e,n)?e[n]++:e[n]=1}),p.sortedIndex=function(e,t,n,a){n=p.iteratee(n,a,1);for(var i=n(t),r=0,s=e.length;s>r;){var o=r+s>>>1;n(e[o])<i?r=o+1:s=o}return r},p.toArray=function(e){return e?p.isArray(e)?s.call(e):e.length===+e.length?p.map(e,p.identity):p.values(e):[]},p.size=function(e){return null==e?0:e.length===+e.length?e.length:p.keys(e).length},p.partition=function(e,t,n){t=p.iteratee(t,n);var a=[],i=[];return p.each(e,function(e,n,r){(t(e,n,r)?a:i).push(e)}),[a,i]},p.first=p.head=p.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:0>t?[]:s.call(e,0,t)},p.initial=function(e,t,n){return s.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},p.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:s.call(e,Math.max(e.length-t,0))},p.rest=p.tail=p.drop=function(e,t,n){return s.call(e,null==t||n?1:t)},p.compact=function(e){return p.filter(e,p.identity)};var v=function(e,t,n,a){if(t&&p.every(e,p.isArray))return o.apply(a,e);for(var i=0,s=e.length;s>i;i++){var c=e[i];p.isArray(c)||p.isArguments(c)?t?r.apply(a,c):v(c,t,n,a):n||a.push(c)}return a};p.flatten=function(e,t){return v(e,t,!1,[])},p.without=function(e){return p.difference(e,s.call(arguments,1))},p.uniq=p.unique=function(e,t,n,a){if(null==e)return[];p.isBoolean(t)||(a=n,n=t,t=!1),null!=n&&(n=p.iteratee(n,a));for(var i=[],r=[],s=0,o=e.length;o>s;s++){var c=e[s];if(t)s&&r===c||i.push(c),r=c;else if(n){var l=n(c,s,e);p.indexOf(r,l)<0&&(r.push(l),i.push(c))}else p.indexOf(i,c)<0&&i.push(c)}return i},p.union=function(){return p.uniq(v(arguments,!0,!0,[]))},p.intersection=function(e){if(null==e)return[];for(var t=[],n=arguments.length,a=0,i=e.length;i>a;a++){var r=e[a];if(!p.contains(t,r)){for(var s=1;n>s&&p.contains(arguments[s],r);s++);s===n&&t.push(r)}}return t},p.difference=function(e){var t=v(s.call(arguments,1),!0,!0,[]);return p.filter(e,function(e){return!p.contains(t,e)})},p.zip=function(e){if(null==e)return[];for(var t=p.max(arguments,"length").length,n=Array(t),a=0;t>a;a++)n[a]=p.pluck(arguments,a);return n},p.object=function(e,t){if(null==e)return{};for(var n={},a=0,i=e.length;i>a;a++)t?n[e[a]]=t[a]:n[e[a][0]]=e[a][1];return n},p.indexOf=function(e,t,n){if(null==e)return-1;var a=0,i=e.length;if(n){if("number"!=typeof n)return a=p.sortedIndex(e,t),e[a]===t?a:-1;a=0>n?Math.max(0,i+n):n}for(;i>a;a++)if(e[a]===t)return a;return-1},p.lastIndexOf=function(e,t,n){if(null==e)return-1;var a=e.length;for("number"==typeof n&&(a=0>n?a+n+1:Math.min(a,n+1));--a>=0;)if(e[a]===t)return a;return-1},p.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=n||1;for(var a=Math.max(Math.ceil((t-e)/n),0),i=Array(a),r=0;a>r;r++,e+=n)i[r]=e;return i};var g=function(){};p.bind=function(e,t){var n,a;if(f&&e.bind===f)return f.apply(e,s.call(arguments,1));if(!p.isFunction(e))throw new TypeError("Bind must be called on a function");return n=s.call(arguments,2),a=function(){if(!(this instanceof a))return e.apply(t,n.concat(s.call(arguments)));g.prototype=e.prototype;var i=new g;g.prototype=null;var r=e.apply(i,n.concat(s.call(arguments)));return p.isObject(r)?r:i}},p.partial=function(e){var t=s.call(arguments,1);return function(){for(var n=0,a=t.slice(),i=0,r=a.length;r>i;i++)a[i]===p&&(a[i]=arguments[n++]);for(;n<arguments.length;)a.push(arguments[n++]);return e.apply(this,a)}},p.bindAll=function(e){var t,n,a=arguments.length;if(1>=a)throw new Error("bindAll must be passed function names");for(t=1;a>t;t++)n=arguments[t],e[n]=p.bind(e[n],e);return e},p.memoize=function(e,t){var n=function(a){var i=n.cache,r=t?t.apply(this,arguments):a;return p.has(i,r)||(i[r]=e.apply(this,arguments)),i[r]};return n.cache={},n},p.delay=function(e,t){var n=s.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},p.defer=function(e){return p.delay.apply(p,[e,1].concat(s.call(arguments,1)))},p.throttle=function(e,t,n){var a,i,r,s=null,o=0;n||(n={});var c=function(){o=n.leading===!1?0:p.now(),s=null,r=e.apply(a,i),s||(a=i=null)};return function(){var l=p.now();o||n.leading!==!1||(o=l);var u=t-(l-o);return a=this,i=arguments,0>=u||u>t?(clearTimeout(s),s=null,o=l,r=e.apply(a,i),s||(a=i=null)):s||n.trailing===!1||(s=setTimeout(c,u)),r}},p.debounce=function(e,t,n){var a,i,r,s,o,c=function(){var l=p.now()-s;t>l&&l>0?a=setTimeout(c,t-l):(a=null,n||(o=e.apply(r,i),a||(r=i=null)))};return function(){r=this,i=arguments,s=p.now();var l=n&&!a;return a||(a=setTimeout(c,t)),l&&(o=e.apply(r,i),r=i=null),o}},p.wrap=function(e,t){return p.partial(t,e)},p.negate=function(e){return function(){return!e.apply(this,arguments)}},p.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,a=e[t].apply(this,arguments);n--;)a=e[n].call(this,a);return a}},p.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},p.before=function(e,t){var n;return function(){return--e>0?n=t.apply(this,arguments):t=null,n}},p.once=p.partial(p.before,2),p.keys=function(e){if(!p.isObject(e))return[];if(h)return h(e);var t=[];for(var n in e)p.has(e,n)&&t.push(n);return t},p.values=function(e){for(var t=p.keys(e),n=t.length,a=Array(n),i=0;n>i;i++)a[i]=e[t[i]];return a},p.pairs=function(e){for(var t=p.keys(e),n=t.length,a=Array(n),i=0;n>i;i++)a[i]=[t[i],e[t[i]]];return a},p.invert=function(e){for(var t={},n=p.keys(e),a=0,i=n.length;i>a;a++)t[e[n[a]]]=n[a];return t},p.functions=p.methods=function(e){var t=[];for(var n in e)p.isFunction(e[n])&&t.push(n);return t.sort()},p.extend=function(e){if(!p.isObject(e))return e;for(var t,n,a=1,i=arguments.length;i>a;a++){t=arguments[a];for(n in t)l.call(t,n)&&(e[n]=t[n])}return e},p.pick=function(e,t,n){var a,i={};if(null==e)return i;if(p.isFunction(t)){t=d(t,n);for(a in e){var r=e[a];t(r,a,e)&&(i[a]=r)}}else{var c=o.apply([],s.call(arguments,1));e=new Object(e);for(var l=0,u=c.length;u>l;l++)a=c[l],a in e&&(i[a]=e[a])}return i},p.omit=function(e,t,n){if(p.isFunction(t))t=p.negate(t);else{var a=p.map(o.apply([],s.call(arguments,1)),String);t=function(e,t){return!p.contains(a,t)}}return p.pick(e,t,n)},p.defaults=function(e){if(!p.isObject(e))return e;for(var t=1,n=arguments.length;n>t;t++){var a=arguments[t];for(var i in a)void 0===e[i]&&(e[i]=a[i])}return e},p.clone=function(e){return p.isObject(e)?p.isArray(e)?e.slice():p.extend({},e):e},p.tap=function(e,t){return t(e),e};var b=function(e,t,n,a){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof p&&(e=e._wrapped),t instanceof p&&(t=t._wrapped);var i=c.call(e);if(i!==c.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}if("object"!=typeof e||"object"!=typeof t)return!1;for(var r=n.length;r--;)if(n[r]===e)return a[r]===t;var s=e.constructor,o=t.constructor;if(s!==o&&"constructor"in e&&"constructor"in t&&!(p.isFunction(s)&&s instanceof s&&p.isFunction(o)&&o instanceof o))return!1;n.push(e),a.push(t);var l,u;if("[object Array]"===i){if(l=e.length,u=l===t.length)for(;l--&&(u=b(e[l],t[l],n,a)););}else{var h,f=p.keys(e);if(l=f.length,u=p.keys(t).length===l)for(;l--&&(h=f[l],u=p.has(t,h)&&b(e[h],t[h],n,a)););}return n.pop(),a.pop(),u};p.isEqual=function(e,t){return b(e,t,[],[])},p.isEmpty=function(e){if(null==e)return!0;if(p.isArray(e)||p.isString(e)||p.isArguments(e))return 0===e.length;for(var t in e)if(p.has(e,t))return!1;return!0},p.isElement=function(e){return!(!e||1!==e.nodeType)},p.isArray=u||function(e){return"[object Array]"===c.call(e)},p.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},p.each(["Arguments","Function","String","Number","Date","RegExp"],function(e){p["is"+e]=function(t){return c.call(t)==="[object "+e+"]"}}),p.isArguments(arguments)||(p.isArguments=function(e){return p.has(e,"callee")}),"function"!=typeof/./&&(p.isFunction=function(e){return"function"==typeof e||!1}),p.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},p.isNaN=function(e){return p.isNumber(e)&&e!==+e},p.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===c.call(e)},p.isNull=function(e){return null===e},p.isUndefined=function(e){return void 0===e},p.has=function(e,t){return null!=e&&l.call(e,t)},p.noConflict=function(){return e._=t,this},p.identity=function(e){return e},p.constant=function(e){return function(){return e}},p.noop=function(){},p.property=function(e){return function(t){return t[e]}},p.matches=function(e){var t=p.pairs(e),n=t.length;return function(e){if(null==e)return!n;e=new Object(e);for(var a=0;n>a;a++){var i=t[a],r=i[0];if(i[1]!==e[r]||!(r in e))return!1}return!0}},p.times=function(e,t,n){var a=Array(Math.max(0,e));t=d(t,n,1);for(var i=0;e>i;i++)a[i]=t(i);return a},p.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},p.now=Date.now||function(){return(new Date).getTime()};var y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},w=p.invert(y),j=function(e){var t=function(t){return e[t]},n="(?:"+p.keys(e).join("|")+")",a=RegExp(n),i=RegExp(n,"g");return function(e){return e=null==e?"":""+e,a.test(e)?e.replace(i,t):e}};p.escape=j(y),p.unescape=j(w),p.result=function(e,t){if(null!=e){var n=e[t];return p.isFunction(n)?e[t]():n}};var x=0;p.uniqueId=function(e){var t=++x+"";return e?e+t:t},p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var R=/(.)^/,k={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},T=/\\|'|\r|\n|\u2028|\u2029/g,F=function(e){return"\\"+k[e]};p.template=function(e,t,n){!t&&n&&(t=n),t=p.defaults({},t,p.templateSettings);var a=RegExp([(t.escape||R).source,(t.interpolate||R).source,(t.evaluate||R).source].join("|")+"|$","g"),i=0,r="__p+='";e.replace(a,function(t,n,a,s,o){return r+=e.slice(i,o).replace(T,F),i=o+t.length,n?r+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":a?r+="'+\n((__t=("+a+"))==null?'':__t)+\n'":s&&(r+="';\n"+s+"\n__p+='"),t}),r+="';\n",t.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{var s=new Function(t.variable||"obj","_",r)}catch(e){throw e.source=r,e}var o=function(e){return s.call(this,e,p)},c=t.variable||"obj";return o.source="function("+c+"){\n"+r+"}",o},p.chain=function(e){var t=p(e);return t._chain=!0,t};var I=function(e){return this._chain?p(e).chain():e};p.mixin=function(e){p.each(p.functions(e),function(t){var n=p[t]=e[t];p.prototype[t]=function(){var e=[this._wrapped];return r.apply(e,arguments),I.call(this,n.apply(p,e))}})},p.mixin(p),p.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];p.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],I.call(this,n)}}),p.each(["concat","join","slice"],function(e){var t=n[e];p.prototype[e]=function(){return I.call(this,t.apply(this._wrapped,arguments))}}),p.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return p})}).call(this),this.FirechatDefaultTemplates=this.FirechatDefaultTemplates||{},this.FirechatDefaultTemplates["templates/layout-full.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div id='firechat' class='full'>\n<div id='firechat-header' class='clearfix'>\n<div class='clearfix'><div class='half firechat-dropdown' style=''>\n<a id='firechat-btn-rooms' class='firechat-dropdown-toggle btn full' data-toggle=\"firechat-dropdown\" >\n<span class='icon user-chat'></span>\nChat Nhóm\n<span class='caret'></span>\n</a>\n<div class='firechat-dropdown-menu full' role='menu'><ul id='firechat-room-list'></ul><div class='firechat-dropdown-footer aligncenter'>\n<button type='button' class='btn twothird center' id='firechat-btn-create-room-prompt'>Tạo Phòng</button>\n</div></div></div>\n<div class='half firechat-dropdown' style=''>\n<a data-event='firechat-user-search-btn' class='btn full firechat-dropdown-toggle' data-toggle=\"firechat-dropdown\" >\n<span class='icon user-group'></span>\nNgười Dùng\n<span class='caret'></span>\n</a>\n<div class='firechat-dropdown-menu' role='menu'>\n<div class='firechat-dropdown-header aligncenter clearfix'>\n<div class='search-wrapper'>\n<span class='icon search'></span>\n<input type='text' data-event='firechat-user-search' data-template='templates/user-search-list-item.html' data-target='firechat-user-search' data-controls='firechat-user-search-controls' class='center fivesixth'>\n</div>\n</div>\n<ul id='firechat-user-search'></ul>\n</div>\n</div>\n<div class='half firechat-dropdown' onclick='openVideoCall()'><a class='btn full firechat-dropdown-toggle'><span class='icon video-call'></span>Gọi Video</a></div>\n</div>\n</div>\n<div id='firechat-tabs' class='clearfix'>\n<ul id='firechat-tab-list' class='nav nav-tabs clearfix'></ul>\n<div id='firechat-tab-content' class='tab-content'></div>\n</div><div id='firechat-footer' class='clearfix'></div>\n</div>";return __p},this.FirechatDefaultTemplates["templates/layout-popout.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div id='firechat' class='full'>\n<div id='firechat-tabs' class='clearfix'>\n<ul id='firechat-tab-list' class='nav nav-tabs clearfix'></ul>\n<div id='firechat-tab-content' class='tab-content'></div>\n</div>\n</div>";return __p},this.FirechatDefaultTemplates["templates/message-context-menu.html"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+="<div data-toggle='firechat-contextmenu' class='contextmenu' data-message-id='"+__e(id)+"'>\n<ul>\n<li><a  data-event='firechat-user-warn'>Warn User</a></li>\n",allowKick&&(__p+="\n<li><a  data-event='firechat-user-kick'>Kick User</a></li>\n"),__p+="\n<li><a  data-event='firechat-user-suspend-hour'>Suspend User (1 Hour)</a></li>\n<li><a  data-event='firechat-user-suspend-day'>Suspend User (1 Day)</a></li>\n<li><a  data-event='firechat-message-delete'>Delete Message</a></li>\n</ul>\n</div>";return __p},this.FirechatDefaultTemplates["templates/message.html"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+="<div class='message message-"+__e(type)+" ",isSelfMessage&&(__p+=" message-self "),__p+="' data-message-id='"+__e(id)+"' data-user-id='"+__e(userId)+"' data-user-name='"+__e(name)+"' data-class=\"firechat-message\">\n<div class='clearfix'>\n<label class='fourfifth'>\n<strong class='name' title='"+__e(name)+"'>"+__e(name)+"</strong>\n<em>("+__e(localtime)+")</em>:\n</label>",disableActions||(__p+="\n<label class='fifth alignright'>\n<a  data-event='firechat-user-chat' class='icon user-chat' title='Mời chat riêng'>&nbsp;</a>\n<a  data-event='firechat-user-mute-toggle' class='icon user-mute' title='Chặn người này'>&nbsp;</a>\n</label>\n"),__p+="</div>\n<div class='clearfix message-content'>\n"+(null==(__t=message)?"":__t)+"\n</div>\n</div>";return __p},this.FirechatDefaultTemplates["templates/prompt-alert.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div class='aligncenter clearfix'>\n<h6>"+__e(message)+"</h6>\n<p class='clearfix'>\n<button type='button' class='btn quarter right close'>Close</button>\n</p>\n</div>";return __p},this.FirechatDefaultTemplates["templates/prompt-create-room.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div class='clearfix'>\n<h6>Đặt tên cho phòng chat:</h6>\n<input data-input='firechat-room-name' type='text' placeholder='Tên phòng chat...' style='margin-bottom: 5px;' maxlength='"+__e(maxLengthRoomName)+"'>\n</div>";return __p},this.FirechatDefaultTemplates["templates/prompt-invitation.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div class='aligncenter clearfix'>\n<h5>"+__e(fromUserName)+"</h5>\n<p>đã mời bạn chat riêng</p>\n<p class='clearfix'>\n<button data-toggle='accept' type='button' class='btn'>Chấp nhận</button>\n<button data-toggle='decline' type='button' class='btn'>Từ chối</button>\n</p>\n</div>";return __p},this.FirechatDefaultTemplates["templates/prompt-invite-private.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div class='aligncenter clearfix'>\n<h6>Mời <strong>"+__e(userName)+"</strong> tới "+__e(roomName)+"?</h6>\n<p class='clearfix'>\n<button data-toggle='accept' type='button' class='btn'>Mời</button>\n<button data-toggle='decline' type='button' class='close btn'>Hủy</button>\n</p>\n</div>";return __p},this.FirechatDefaultTemplates["templates/prompt-invite-reply.html"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+="<div class='aligncenter clearfix'>\n<h5>"+__e(toUserName)+"</h5>\n<p>\n",__p+="accepted"===status?" đã chấp nhận lời mời của bạn. ":" đã từ chối lời mời của bạn. ",__p+="\n</p>\n</div>";return __p},this.FirechatDefaultTemplates["templates/prompt-user-mute.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div class='aligncenter clearfix'>\n<h5>"+__e(userName)+"</h5>\n<p class='clearfix'>\n<button data-toggle='accept' type='button' class='btn'>Chặn</button>\n<button data-toggle='decline' type='button' class='btn'>Hủy</button>\n</p>\n</div>";return __p},this.FirechatDefaultTemplates["templates/prompt.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div class='prompt hidden'>\n<div class='prompt-header'>\n"+__e(title)+"\n<a  class='close right'>X</a>\n</div>\n<div class='prompt-body clearfix'>\n"+(null==(__t=content)?"":__t)+"\n</div>\n<div class='prompt-footer'></div>\n</div>";return __p},this.FirechatDefaultTemplates["templates/room-list-item.html"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+="<li data-room-type='"+__e(type)+"' data-room-id='"+__e(id)+"' data-room-name='"+__e(name)+"'>\n<a  class='clearfix ",isRoomOpen&&(__p+=" highlight "),__p+="'>\n<span class='left' title='"+__e(name)+"'>"+__e(name)+"</span>\n</a>\n</li>";return __p},this.FirechatDefaultTemplates["templates/room-user-list-item.html"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+="<li data-user-id='"+__e(id)+"' data-user-name='"+__e(name)+"'>\n<a  class='clearfix'>\n<span class='left twothird clipped' title='"+__e(name)+"'>"+__e(name)+"</span>",disableActions||(__p+="\n<span data-event='firechat-user-mute-toggle' class='icon user-mute right ",isMuted&&(__p+=" red "),__p+="' title='Chặn người dùng'>&nbsp;</span>\n<span data-event='firechat-user-chat' class='icon user-chat right' title='Mời chat riêng'>&nbsp;</span>\n"),__p+="\n</a>\n</li>";return __p},this.FirechatDefaultTemplates["templates/room-user-search-list-item.html"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+="<li data-user-id='"+__e(id)+"' data-user-name='"+__e(name)+"'>\n<a  class='clearfix'>\n",__p+=disableActions?"\n<span class='left fourfifth clipped' title='"+__e(name)+"'>"+__e(name)+"</span>\n":"\n<span data-event='firechat-user-invite' class='left fourfifth clipped' title='"+__e(name)+"'>"+__e(name)+"</span>\n<span data-event='firechat-user-invite' class='icon plus right' title='Mời vào phòng'>+</span>\n",__p+="\n</a>\n</li>";return __p},this.FirechatDefaultTemplates["templates/tab-content.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div id='"+__e(id)+"' data-room-id='"+__e(id)+"' class='tab-pane'>\n<div class='tab-pane-menu clearfix'><div class='firechat-dropdown twofifth'>\n<a data-event='firechat-user-room-list-btn' class='full btn firechat-dropdown-toggle' data-toggle=\"firechat-dropdown\"  data-target='firechat-room-user-list-"+__e(id)+"'>\n<span class='icon user-group'></span>\nPhòng Chat\n<span class='caret'></span>\n</a>\n<div class='firechat-dropdown-menu' role='menu'>\n<ul id='firechat-room-user-list-"+__e(id)+"' class='full'></ul>\n</div>\n</div><div class='firechat-dropdown twofifth'>\n<a data-event='firechat-user-search-btn' class='full btn firechat-dropdown-toggle' data-toggle=\"firechat-dropdown\" >\n<span class='icon plus'>+</span>\nMời Chat\n<span class='caret'></span>\n</a><div class='firechat-dropdown-menu' role='menu'>\n<div class='firechat-dropdown-header aligncenter clearfix'>\n<div class='search-wrapper'>\n<span class='icon search'></span>\n<input type='text' data-event='firechat-user-search' data-template='templates/room-user-search-list-item.html' data-target='firechat-room-user-search-"+__e(id)+"' data-controls='firechat-room-user-search-controls-"+__e(id)+"' class='center fivesixth'>\n</div>\n</div>\n<ul id='firechat-room-user-search-"+__e(id)+"'></ul>\n</div>\n</div></div><div class='clearfix'>\n<div id='firechat-messages"+__e(id)+"' class='chat'></div>\n</div><div class='clearfix'>\n<label>Tin nhắn mới:</label>\n<textarea id='textarea"+__e(id)+"' placeholder='Nhập vào nội dung tin nhắn...'></textarea>\n</div>\n</div>";return __p},this.FirechatDefaultTemplates["templates/tab-menu-item.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<li onClick='changeRoomChat(this)' data-room-id='"+__e(id)+"'>\n<a data-toggle='firechat-tab' title='"+__e(name)+"'>"+__e(name)+"</a>\n<a data-event='firechat-close-tab' class='icon close right close-room-chat' style='15px 5px' title='Đóng phòng chat'></a>\n</li>";return __p},this.FirechatDefaultTemplates["templates/user-search-list-item.html"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+="<li data-user-id='"+__e(id)+"' data-user-name='"+__e(name)+"'>\n<a  class='clearfix'>\n",__p+=disableActions?"\n<span class='left fivesixth clipped' title='"+__e(name)+"'>"+__e(name)+"</span>\n":"\n<span data-event='firechat-user-chat' class='left fivesixth clipped' title='"+__e(name)+"'>"+__e(name)+"</span>\n<span data-event='firechat-user-chat' class='icon user-chat right' title='Mời chat riêng'>&nbsp;</span>\n",__p+="\n</a>\n</li>";return __p},function(e){Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,a=function(){},i=function(){return n.apply(this instanceof a&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return a.prototype=this.prototype,i.prototype=new a,i}),Object.keys=Object.keys||function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}}(),function(){function e(e,t){this._firechatRef=e,this._firebaseApp=e.database.app,this._user=null,this._userId=null,this._userName=null,this._isModerator=!1,this._sessionId=null,this._events={},this._rooms={},this._presenceBits={},this._userRef=null,this._messageRef=this._firechatRef.child("room-messages"),this._roomRef=this._firechatRef.child("room-metadata"),this._privateRoomRef=this._firechatRef.child("room-private-metadata"),this._moderatorsRef=this._firechatRef.child("moderators"),this._suspensionsRef=this._firechatRef.child("suspensions"),this._usersOnlineRef=this._firechatRef.child("user-names-online"),this._options=t||{},this._options.numMaxMessages=this._options.numMaxMessages||50}var t=this,n=t.Firechat;e.noConflict=function(){return t.Firechat=n,e},t.Firechat=e,e.prototype={_loadUserMetadata:function(e){var n=this;this._userRef.transaction(function(e){if(!e||!e.id||!e.name)return{id:n._userId,name:n._userName}},function(a,i,r){n._user=r.val(),n._moderatorsRef.child(n._userId).once("value",function(a){n._isModerator=!!a.val(),t.setTimeout(e,0)})})},_setupDataEvents:function(){var e=this._firechatRef.root.child(".info/connected");e.on("value",function(e){if(e.val()===!0)for(var t in this._presenceBits){var n=this._presenceBits[t],a=n.ref;a.onDisconnect().set(n.offlineValue),a.set(n.onlineValue)}},this),this._queuePresenceOperation(this._sessionRef,!0,null);var t=this._usersOnlineRef.child(this._userName.toLowerCase()),n=t.child(this._sessionId);this._queuePresenceOperation(n,{id:this._userId,name:this._userName},null),this._userRef.on("value",this._onUpdateUser,this),this._userRef.child("invites").on("child_added",this._onFirechatInvite,this),this._userRef.child("notifications").on("child_added",this._onNotification,this)},_addEventCallback:function(e,t){this._events[e]=this._events[e]||[],this._events[e].push(t)},_getEventCallbacks:function(e){return this._events.hasOwnProperty(e)?this._events[e]:[]},_invokeEventCallbacks:function(e){var t=[],n=this._getEventCallbacks(e);Array.prototype.push.apply(t,arguments),t=t.slice(1);for(var a=0;a<n.length;a+=1)n[a].apply(null,t)},_queuePresenceOperation:function(e,t,n){e.onDisconnect().set(n),e.set(t),this._presenceBits[e.toString()]={ref:e,onlineValue:t,offlineValue:n}},_removePresenceOperation:function(e,t){var n=e.toString();e.onDisconnect().cancel(),e.set(t),delete this._presenceBits[n]},_onUpdateUser:function(e){this._user=e.val(),this._userName=this._user.name,this._invokeEventCallbacks("user-update",this._user)},_onAuthRequired:function(){this._invokeEventCallbacks("auth-required")},_onEnterRoom:function(e){this._invokeEventCallbacks("room-enter",e)},_onNewMessage:function(e,t){var n=t.val();n.id=t.key,this._invokeEventCallbacks("message-add",e,n)},_onRemoveMessage:function(e,t){var n=t.key;this._invokeEventCallbacks("message-remove",e,n)},_onLeaveRoom:function(e){this._invokeEventCallbacks("room-exit",e)},_onNotification:function(e){var t=e.val();t.read||(("suspension"!==t.notificationType||t.data.suspendedUntil<(new Date).getTime())&&e.ref.child("read").set(!0),this._invokeEventCallbacks("notification",t))},_onFirechatInvite:function(e){var t=this,n=e.val();n.status||(n.id=n.id||e.key,t.getRoom(n.roomId,function(e){n.toRoomName=e.name,t._invokeEventCallbacks("room-invite",n)}))},_onFirechatInviteResponse:function(e){var t=e.val();t.id=t.id||e.key,this._invokeEventCallbacks("room-invite-response",t)}},e.prototype.setUser=function(e,n,a){var i=this;i._firebaseApp.auth().onAuthStateChanged(function(r){r?(i._userId=e.toString(),i._userName=n.toString(),i._userRef=i._firechatRef.child("users").child(i._userId),i._sessionRef=i._userRef.child("sessions").push(),i._sessionId=i._sessionRef.key,i._loadUserMetadata(function(){t.setTimeout(function(){a(i._user),i._setupDataEvents()},0)})):i.warn("Firechat requires an authenticated Firebase reference. Pass an authenticated reference before loading.")})},e.prototype.resumeSession=function(){this._userRef.child("rooms").once("value",function(e){var t=e.val();for(var n in t)this.enterRoom(t[n].id)},function(){},this)},e.prototype.on=function(e,t){this._addEventCallback(e,t)},e.prototype.createRoom=function(e,t,n){var a=this,i=this._roomRef.push(),r={id:i.key,name:e,type:t||"public",createdByUserId:this._userId,createdAt:firebase.database.ServerValue.TIMESTAMP};"private"===t&&(r.authorizedUsers={},r.authorizedUsers[this._userId]=!0),i.set(r,function(e){e||a.enterRoom(i.key),n&&n(i.key)})},e.prototype.enterRoom=function(e){var t=this;t.getRoom(e,function(n){var a=n.name;if(e&&a&&!t._rooms[e]){if(t._rooms[e]=!0,t._user){t._userRef.child("rooms").child(e).set({id:e,name:a,active:!0});var i=t._firechatRef.child("room-users").child(e).child(t._userId).child(t._sessionId);t._queuePresenceOperation(i,{id:t._userId,name:t._userName},null)}t._onEnterRoom({id:e,name:a}),t._roomRef.child(e).once("value",function(n){
t._messageRef.child(e).limitToLast(t._options.numMaxMessages).on("child_added",function(n){t._onNewMessage(e,n)},function(){t.leaveRoom(e)},t),t._messageRef.child(e).limitToLast(t._options.numMaxMessages).on("child_removed",function(n){t._onRemoveMessage(e,n)},function(){},t)},function(){},t)}})},e.prototype.leaveRoom=function(e){var t=this,n=t._firechatRef.child("room-users").child(e);if(t._messageRef.child(e).off(),t._user){var a=n.child(t._userId).child(t._sessionId);t._removePresenceOperation(a,null),t._userRef.child("rooms").child(e).remove()}delete t._rooms[e],t._onLeaveRoom(e)},e.prototype.sendMessage=function(e,t,n,a){var i,r=this,s={userId:r._userId,name:r._userName,timestamp:firebase.database.ServerValue.TIMESTAMP,message:t,type:n||"default"};return r._user?(i=r._messageRef.child(e).push(),void i.setWithPriority(s,firebase.database.ServerValue.TIMESTAMP,a)):(r._onAuthRequired(),void(a&&a(new Error("Not authenticated or user not set!"))))},e.prototype.deleteMessage=function(e,t,n){var a=this;a._messageRef.child(e).child(t).remove(n)},e.prototype.toggleUserMute=function(e,t){var n=this;return n._user?void n._userRef.child("muted").child(e).transaction(function(e){return!e||null},t):(n._onAuthRequired(),void(t&&t(new Error("Not authenticated or user not set!"))))},e.prototype.sendSuperuserNotification=function(e,t,n,a){var i=this,r=i._firechatRef.child("users").child(e).child("notifications");r.push({fromUserId:i._userId,timestamp:firebase.database.ServerValue.TIMESTAMP,notificationType:t,data:n||{}},a)},e.prototype.warnUser=function(e){var t=this;t.sendSuperuserNotification(e,"warning")},e.prototype.suspendUser=function(e,t,n){var a=this,i=(new Date).getTime()+1e3*t;a._suspensionsRef.child(e).set(i,function(t){return t&&n?n(t):(a.sendSuperuserNotification(e,"suspension",{suspendedUntil:i}),n(null))})},e.prototype.inviteUser=function(e,t){var n=this,a=function(){var a=n._firechatRef.child("users").child(e).child("invites").push();a.set({id:a.key,fromUserId:n._userId,fromUserName:n._userName,roomId:t}),a.on("value",n._onFirechatInviteResponse,function(){},n)};return n._user?void n.getRoom(t,function(i){if("private"===i.type){var r=n._roomRef.child(t).child("authorizedUsers");r.child(e).set(!0,function(e){e||a()})}else a()}):void n._onAuthRequired()},e.prototype.acceptInvite=function(e,t){var n=this;n._userRef.child("invites").child(e).once("value",function(a){var i=a.val();return null===i&&t?t(new Error("acceptInvite("+e+"): invalid invite id")):(n.enterRoom(i.roomId),void n._userRef.child("invites").child(e).update({status:"accepted",toUserName:n._userName},t))},n)},e.prototype.declineInvite=function(e,t){var n=this,a={status:"declined",toUserName:n._userName};n._userRef.child("invites").child(e).update(a,t)},e.prototype.getRoomList=function(e){var t=this;t._roomRef.once("value",function(t){e(t.val())})},e.prototype.getUsersByRoom=function(){var e=this,n=arguments[0],a=e._firechatRef.child("room-users").child(n),i=arguments[arguments.length-1],r=null;arguments.length>2&&(r=arguments[1]),a=r?a.limitToLast(r):a,a.once("value",function(e){var n=e.val()||{},a={};for(var r in n)for(var s in n[r]){a[r]=n[r][s];break}t.setTimeout(function(){i(a)},0)})},e.prototype.getUsersByPrefix=function(e,n,a,i,r){var s=this._usersOnlineRef,o=e.toLowerCase();s=n?s.startAt(null,n):a?s.endAt(null,a):o?s.startAt(null,o):s.startAt(),s=i?s.limitToLast(i):s,s.once("value",function(n){var a=n.val()||{},i={};for(var s in a){var c,l,u=a[s];for(var h in u){c=u[h].name,l=u[h].id;break}e.length>0&&0!==c.toLowerCase().indexOf(o)||(i[c]={name:c,id:l})}t.setTimeout(function(){r(i)},0)})},e.prototype.getRoom=function(e,t){this._roomRef.child(e).once("value",function(e){t(e.val())})},e.prototype.userIsModerator=function(){return this._isModerator},e.prototype.warn=function(e){console&&(e="Firechat Warning: "+e,"function"==typeof console.warn?console.warn(e):"function"==typeof console.log&&console.log(e))}}(),function(e){function t(t,n,a){if(!t)throw new Error("FirechatUI: Missing required argument `firebaseRef`");if(!n)throw new Error("FirechatUI: Missing required argument `el`");a=a||{},this._options=a,this._el=n,this._user=null,this._chat=new Firechat(t,a),this._roomQueue=[],this.maxLengthUsername=15,this.maxLengthUsernameDisplay=15,this.maxLengthRoomName=24,this.maxLengthMessage=120,this.maxUserSearchResults=100,this.urlPattern=/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,this.pseudoUrlPattern=/(^|[^\/])(www\.[\S]+(\b|$))/gim,this._renderLayout(),this.$wrapper=e("#firechat"),this.$roomList=e("#firechat-room-list"),this.$tabList=e("#firechat-tab-list"),this.$tabContent=e("#firechat-tab-content"),this.$messages={},this.$rateLimit={limitCount:10,limitInterval:1e4,limitWaitTime:3e4,history:{}},this._bindUIEvents(),this._bindDataEvents()}if(!e||parseInt(e().jquery.replace(/\./g,""),10)<170)throw new Error("jQuery 1.7 or later required!");var n=this,a=n.FirechatUI;if(n.FirechatUI=t,!self.FirechatDefaultTemplates)throw new Error("Unable to find chat templates!");t.noConflict=function(){return n.FirechatUI=a,t},t.prototype={_bindUIEvents:function(){this._bindForHeightChange(),this._bindForTabControls(),this._bindForRoomList(),this._bindForUserRoomList(),this._bindForUserSearch(),this._bindForUserMuting(),this._bindForChatInvites(),this._bindForRoomListing(),this._setupTabs(),this._setupDropdowns(),this._bindTextInputFieldLimits()},_bindDataEvents:function(){this._chat.on("user-update",this._onUpdateUser.bind(this)),this._chat.on("room-enter",this._onEnterRoom.bind(this)),this._chat.on("room-exit",this._onLeaveRoom.bind(this)),this._chat.on("message-add",this._onNewMessage.bind(this)),this._chat.on("message-remove",this._onRemoveMessage.bind(this)),this._chat.on("room-invite",this._onChatInvite.bind(this)),this._chat.on("room-invite-response",this._onChatInviteResponse.bind(this)),this._chat.on("notification",this._onNotification.bind(this))},_renderLayout:function(){var t=FirechatDefaultTemplates["templates/layout-full.html"];e(this._el).html(t({maxLengthUsername:this.maxLengthUsername}))},_onUpdateUser:function(t){this._user=t;var n=this._user.muted||{};e('[data-event="firechat-user-mute-toggle"]').each(function(t,a){var i=e(this).closest("[data-user-id]").data("user-id");e(this).toggleClass("red",!!n[i])});for(var a in n)e('.message[data-user-id="'+a+'"]').fadeOut()},_onEnterRoom:function(e){this.attachTab(e.id,e.name)},_onLeaveRoom:function(e){this.removeTab(e),this._roomQueue.length>0&&this._chat.enterRoom(this._roomQueue.shift(e))},_onNewMessage:function(e,t){var n=t.userId;this._user&&this._user.muted&&this._user.muted[n]||this.showMessage(e,t)},_onRemoveMessage:function(e,t){this.removeMessage(e,t)},_onChatInvite:function(e){var t=this,n=FirechatDefaultTemplates["templates/prompt-invitation.html"],a=this.prompt("Lời mời",n(e));a.find("a.close").click(function(){return a.remove(),t._chat.declineInvite(e.id),!1}),a.find("[data-toggle=accept]").click(function(){return a.remove(),t._chat.acceptInvite(e.id),!1}),a.find("[data-toggle=decline]").click(function(){return a.remove(),t._chat.declineInvite(e.id),!1})},_onChatInviteResponse:function(e){if(e.status){var t,n=this,a=FirechatDefaultTemplates["templates/prompt-invite-reply.html"];e.status&&"accepted"===e.status?(t=this.prompt("Chấp nhận",a(e)),this._chat.getRoom(e.roomId,function(t){n.attachTab(e.roomId,t.name)})):t=this.prompt("Từ chối",a(e)),t.find("a.close").click(function(){return t.remove(),!1})}},_onNotification:function(e){if("warning"===e.notificationType)this.renderAlertPrompt("Warning","You are being warned for inappropriate messaging. Further violation may result in temporary or permanent ban of service.");else if("suspension"===e.notificationType){var t=e.data.suspendedUntil,n=Math.round((t-(new Date).getTime())/1e3),a="";if(n>0){if(n>7200){var i=Math.floor(n/3600);a=i+" hours, ",n-=3600*i}a+=Math.floor(n/60)+" minutes",this.renderAlertPrompt("Suspended","A moderator has suspended you for violating site rules. You cannot send messages for another "+a+".")}}}},t.prototype.setUser=function(e,t){var n=this;n._chat.setUser(e,t,function(e){n._user=e,n._chat.userIsModerator()&&n._bindSuperuserUIEvents(),n._chat.resumeSession()})},t.prototype.on=function(e,t){this._chat.on(e,t)},t.prototype._bindSuperuserUIEvents=function(){var t=this,n=function(t){var n=e(this),a=n.closest("[data-message-id]").data("message-id"),i=e('[data-message-id="'+a+'"]').closest("[data-user-id]").data("user-id"),r=e('[data-message-id="'+a+'"]').closest("[data-room-id]").data("room-id");return{messageId:a,userId:i,roomId:r}},a=function(){e('[data-toggle="firechat-contextmenu"]').each(function(){e(this).remove()}),e("#firechat .message.highlighted").each(function(){e(this).removeClass("highlighted")})},i=function(i){var r,s=e(this),o=s.closest("[data-message-id]"),c=FirechatDefaultTemplates["templates/message-context-menu.html"],l=n.call(this,i);i.preventDefault(),a(),s.addClass("highlighted"),t._chat.getRoom(l.roomId,function(n){r=e(c({id:o.data("message-id")})),r.css({left:i.clientX,top:i.clientY}).appendTo(t.$wrapper)})};e(document).bind("click",{self:this},function(e){e.button&&2==e.button||a()}),e(document).delegate('[data-class="firechat-message"]',"contextmenu",i),e(document).delegate('[data-event="firechat-user-warn"]',"click",function(e){var a=n.call(this,e);t._chat.warnUser(a.userId)}),e(document).delegate('[data-event="firechat-user-suspend-hour"]',"click",function(e){var a=n.call(this,e);t._chat.suspendUser(a.userId,3600)}),e(document).delegate('[data-event="firechat-user-suspend-day"]',"click",function(e){var a=n.call(this,e);t._chat.suspendUser(a.userId,86400)}),e(document).delegate('[data-event="firechat-message-delete"]',"click",function(e){var a=n.call(this,e);t._chat.deleteMessage(a.roomId,a.messageId)})},t.prototype._bindForHeightChange=function(){var t=e(this._el),n=null;setInterval(function(){var a=t.height();a!=n&&(n=a,e(".chat").each(function(e,t){}))},500)},t.prototype._bindForTabControls=function(){var t=this;e(document).delegate('[data-event="firechat-close-tab"]',"click",function(n){var a=e(this).closest("[data-room-id]").data("room-id");return t._chat.leaveRoom(a),!1})},t.prototype._bindForRoomList=function(){var t=this;e("#firechat-btn-rooms").bind("click",function(){if(!e(this).parent().hasClass("open")){var n=(e(this),FirechatDefaultTemplates["templates/room-list-item.html"]),a=function(){var n=e(this).parent(),a=n.data("room-id"),i=n.data("room-name");return t.$messages[a]?t.focusTab(a):t._chat.enterRoom(a,i),!1};t._chat.getRoomList(function(i){t.$roomList.empty();for(var r in i){var s=i[r];if("public"==s.type){s.isRoomOpen=!!t.$messages[s.id];var o=e(n(s));o.children("a").bind("click",a),t.$roomList.append(o.toggle(!0))}}})}})},t.prototype._bindForUserRoomList=function(){var t=this;e(document).delegate('[data-event="firechat-user-room-list-btn"]',"click",function(n){n.stopPropagation();var a=e(this),i=a.closest("[data-room-id]").data("room-id"),r=FirechatDefaultTemplates["templates/room-user-list-item.html"],s=a.data("target"),o=e("#"+s);o.empty(),t._chat.getUsersByRoom(i,function(n){for(var a in n)user=n[a],user.disableActions=!t._user||user.id===t._user.id,user.nameTrimmed=t.trimWithEllipsis(user.name,t.maxLengthUsernameDisplay),user.isMuted=t._user&&t._user.muted&&t._user.muted[user.id],o.append(e(r(user)));t.sortListLexicographically("#"+s)})})},t.prototype._bindForUserSearch=function(){var t=this,n=function(t){var n=e(this),i=n.data("target"),r=n.data("controls"),s=n.data("template"),o=n.val()||n.data("prefix")||"",c=n.data("startAt")||null,l=n.data("endAt")||null;t.preventDefault(),a(i,s,r,o,c,l)},a=function(n,a,i,r,s,o){var c=e("#"+n),l=e("#"+i),u=FirechatDefaultTemplates[a];t._chat.getUsersByPrefix(r,s,o,t.maxUserSearchResults,function(e){var n,a,i,s,o,h=0;c.empty();for(i in e){var f=e[i];if(f.disableActions=!t._user||f.id===t._user.id,h+=1,c.append(u(f)),1===h)s=f.name.toLowerCase();else if(h>=t.maxUserSearchResults){o=f.name.toLowerCase();break}}l&&(n=l.find('[data-toggle="firechat-pagination-prev"]'),a=l.find('[data-toggle="firechat-pagination-next"]'),o?a.data("event","firechat-user-search").data("startAt",o).data("prefix",r).removeClass("disabled").removeAttr("disabled"):a.data("event",null).data("startAt",null).data("prefix",null).addClass("disabled").attr("disabled","disabled"))})};e(document).delegate('[data-event="firechat-user-search"]',"keyup",n),e(document).delegate('[data-event="firechat-user-search"]',"click",n),e(document).delegate('[data-event="firechat-user-search-btn"]',"click",function(t){t.stopPropagation();var n=e(this).next("div.firechat-dropdown-menu").find("input");n.focus(),n.trigger(jQuery.Event("keyup"))}),e(document).delegate('[data-event="firechat-user-search"]',"click",function(e){e.stopPropagation()})},t.prototype._bindForUserMuting=function(){var t=this;e(document).delegate('[data-event="firechat-user-mute-toggle"]',"click",function(n){var a=e(this),i=a.closest("[data-user-id]").data("user-id"),r=a.closest("[data-user-name]").data("user-name"),s=a.hasClass("red"),o=FirechatDefaultTemplates["templates/prompt-user-mute.html"];if(n.preventDefault(),s)t._chat.toggleUserMute(i);else{var c=t.prompt("Chặn người này?",o({userName:r}));c.find("a.close").first().click(function(){return c.remove(),!1}),c.find("[data-toggle=decline]").first().click(function(){return c.remove(),!1}),c.find("[data-toggle=accept]").first().click(function(){return t._chat.toggleUserMute(i),c.remove(),!1})}})},t.prototype._bindForChatInvites=function(){var t=this,n=function(n){var a,i=e(this),r=i.closest("[data-user-id]").data("user-id"),s=i.closest("[data-room-id]").data("room-id"),o=i.closest("[data-user-name]").data("user-name"),c=FirechatDefaultTemplates["templates/prompt-invite-private.html"];return t._chat.getRoom(s,function(e){return a=t.prompt("Lời mời",c({userName:o,roomName:e.name})),a.find("a.close").click(function(){return a.remove(),!1}),a.find("[data-toggle=decline]").click(function(){return a.remove(),!1}),a.find("[data-toggle=accept]").first().click(function(){return a.remove(),t._chat.inviteUser(r,s,e.name),!1}),!1}),!1},a=function(n){var a,i=e(this),r=i.closest("[data-user-id]").data("user-id"),s=i.closest("[data-user-name]").data("user-name"),o=FirechatDefaultTemplates["templates/prompt-invite-private.html"];return r&&s&&(a=t.prompt("Chat riêng",o({userName:s,roomName:"chat riêng"})),a.find("a.close").click(function(){return a.remove(),!1}),a.find("[data-toggle=decline]").click(function(){return a.remove(),!1}),a.find("[data-toggle=accept]").first().click(function(){a.remove();var e="chat riêng";return t._chat.createRoom(e,"private",function(n){t._chat.inviteUser(r,n,e)}),!1})),!1};e(document).delegate('[data-event="firechat-user-chat"]',"click",a),e(document).delegate('[data-event="firechat-user-invite"]',"click",n)},t.prototype._bindForRoomListing=function(){var t=this,n=e("#firechat-btn-create-room-prompt"),a=e("#firechat-btn-create-room");n.bind("click",function(e){return t.promptCreateRoom(),!1}),a.bind("click",function(n){var a=e("#firechat-input-room-name").val();return e("#firechat-prompt-create-room").remove(),t._chat.createRoom(a),!1})},t.prototype._setupTabs=function(){var t=function(t){var a,i,r=t,s=r.closest("ul:not(.firechat-dropdown-menu)"),o=r.attr("data-target"),c=s.find(".active:last a")[0];o||(o=r.attr("href"),o=o&&o.replace(/.*(?=#[^\s]*$)/,"")),r.parent("li").hasClass("active")||(i=e.Event("show",{relatedTarget:c}),r.trigger(i),i.isDefaultPrevented()||(a=e(o),n(r.parent("li"),s),n(a,a.parent(),function(){r.trigger({type:"shown",relatedTarget:c})})))},n=function(t,n,a){function i(){r.removeClass("active").find("> .firechat-dropdown-menu > .active").removeClass("active"),t.addClass("active"),s?t.addClass("in"):t.removeClass("fade"),t.parent(".firechat-dropdown-menu")&&t.closest("li.firechat-dropdown").addClass("active"),a&&a()}var r=n.find("> .active"),s=a&&e.support.transition&&r.hasClass("fade");s?r.one(e.support.transition.end,i):i(),r.removeClass("in")};e(document).delegate('[data-toggle="firechat-tab"]',"click",function(n){n.preventDefault(),t(e(this))})},t.prototype._setupDropdowns=function(){var t=function(t){var i=e(this),r=a(i),s=r.hasClass("open");if(!i.is(".disabled, :disabled"))return n(),s||r.toggleClass("open"),i.focus(),!1},n=function(){e("[data-toggle=firechat-dropdown]").each(function(){a(e(this)).removeClass("open")})},a=function(t){var n,a=t.attr("data-target");return a||(a=t.attr("href"),a=a&&/#/.test(a)&&a.replace(/.*(?=#[^\s]*$)/,"")),n=a&&"#"!==a&&e(a),n&&n.length||(n=t.parent()),n};e(document).bind("click",n).delegate(".firechat-dropdown-menu","click",function(e){e.stopPropagation()}).delegate("[data-toggle=firechat-dropdown]","click",t)},t.prototype._bindTextInputFieldLimits=function(){e("body").delegate('input[data-provide="limit"], textarea[data-provide="limit"]',"keyup",function(t){var n=e(this),a=e(n.data("counter")),i=n.attr("maxlength"),r=n.val().length;a.html(Math.max(0,i-r))})},t.prototype.renderAlertPrompt=function(e,t){var n=FirechatDefaultTemplates["templates/prompt-alert.html"],a=this.prompt(e,n({message:t}));a.find(".close").click(function(){return a.remove(),!1})},t.prototype.toggleInputs=function(t){e("#firechat-tab-content textarea").each(function(){var n=e(this);t?e(this).val(""):e(this).val("You have exceeded the message limit, please wait before sending."),n.prop("disabled",!t)}),e("#firechat-input-name").prop("disabled",!t)},t.prototype.attachTab=function(t,n){var a=this;if(this.$messages[t])return void this.focusTab(t);var i={id:t,name:n},r=FirechatDefaultTemplates["templates/tab-content.html"],s=e(r(i));this.$tabContent.prepend(s);var o=e("#firechat-messages"+t);this.$messages[t]=o;var c=s.find("textarea").first();c.bind("keydown",function(e){var n=a.trimWithEllipsis(c.val(),a.maxLengthMessage);if(13===e.which&&""!==n)return c.val(""),a._chat.sendMessage(t,n),!1});var l=FirechatDefaultTemplates["templates/tab-menu-item.html"],u=e(l(i));this.$tabList.prepend(u),u.bind("shown",function(e){o.scrollTop(o[0].scrollHeight)});var h=this.$tabList.children("li"),f=Math.floor(e("#firechat-tab-list").width()/h.length);this.$tabList.children("li").css("width",f),this.$roomList.children("[data-room-id="+t+"]").children("a").addClass("highlight"),e("#firechat-btn-room-user-list-"+t).bind("click",function(){return a.sortListLexicographically("#firechat-room-user-list-"+t),!1}),this.focusTab(t)},t.prototype.focusTab=function(e){if(this.$messages[e]){var t=this.$tabList.find("[data-room-id="+e+"]").find("a");t.length&&t.first().trigger("click")}},t.prototype.removeTab=function(t){delete this.$messages[t],this.$tabContent.find("[data-room-id="+t+"]").remove(),this.$tabList.find("[data-room-id="+t+"]").remove();var n=this.$tabList.children("li"),a=Math.floor(e("#firechat-tab-list").width()/n.length);this.$tabList.children("li").css("width",a),this.$tabList.find('[data-toggle="firechat-tab"]').first().trigger("click"),this.$roomList.children("[data-room-id="+t+"]").children("a").removeClass("highlight")},t.prototype.showMessage=function(t,n){var a=this,i={id:n.id,localtime:a.formatTime(n.timestamp),message:n.message||"",userId:n.userId,name:n.name,type:n.type||"default",isSelfMessage:a._user&&n.userId==a._user.id,disableActions:!a._user||n.userId==a._user.id};i.message=_.map(i.message.split(" "),function(e){return a.urlPattern.test(e)||a.pseudoUrlPattern.test(e)?a.linkify(encodeURI(e)):_.escape(e)}).join(" "),i.message=a.trimWithEllipsis(i.message,a.maxLengthMessage);var r=FirechatDefaultTemplates["templates/message.html"],s=e(r(i)),o=a.$messages[t];if(o){var c=!1;o.scrollTop()/(o[0].scrollHeight-o[0].offsetHeight)>=.95?c=!0:o[0].scrollHeight<=o.height()&&(c=!0),o.append(s),c&&o.scrollTop(o[0].scrollHeight)}},t.prototype.removeMessage=function(t,n){e('.message[data-message-id="'+n+'"]').remove()},t.prototype.sortListLexicographically=function(t){e(t).children("li").sort(function(t,n){var a=e(t).text().toUpperCase(),i=e(n).text().toUpperCase();return a<i?-1:a>i?1:0}).appendTo(t)},t.prototype.trimWithEllipsis=function(e,t){return e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),t&&e.length<=t?e:e.substring(0,t)+"..."},t.prototype.formatTime=function(e){var t=e?new Date(e):new Date,n=t.getHours()||12,a=""+t.getMinutes(),i=t.getHours()>=12?"pm":"am";return n=n>12?n-12:n,a=a.length<2?"0"+a:a,""+n+":"+a+i},t.prototype.promptCreateRoom=function(){var e=this,t=FirechatDefaultTemplates["templates/prompt-create-room.html"],n=this.prompt("Tạo phòng Chat mới",t({maxLengthRoomName:this.maxLengthRoomName,isModerator:e._chat.userIsModerator()}));n.find("a.close").first().click(function(){return n.remove(),!1}),n.find("[data-toggle=submit]").first().click(function(){var t=n.find("[data-input=firechat-room-name]").first().val();return""!==t&&(e._chat.createRoom(t,"public"),n.remove()),!1}),n.find("[data-input=firechat-room-name]").first().focus(),n.find("[data-input=firechat-room-name]").first().bind("keydown",function(t){if(13===t.which){var a=n.find("[data-input=firechat-room-name]").first().val();if(""!==a)return e._chat.createRoom(a,"public"),n.remove(),!1}})},t.prototype.prompt=function(t,n){var a,i=FirechatDefaultTemplates["templates/prompt.html"];return a=e(i({title:t,content:n})).css({top:this.$wrapper.position().top+.333*this.$wrapper.height(),left:this.$wrapper.position().left+.125*this.$wrapper.width(),width:.75*this.$wrapper.width()}),this.$wrapper.append(a.removeClass("hidden")),a},t.prototype.linkify=function(e){var t=this;return e.replace(t.urlPattern,'<a target="_blank" href="$&">$&</a>').replace(t.pseudoUrlPattern,'$1<a target="_blank" href="http://$2">$2</a>')}}(jQuery);